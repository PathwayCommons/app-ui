
// tests for enrichment service
const chai = require('chai');
const _ = require('lodash');
const enrichment = require('../src/server/enrichment/enrichment');
const expect = chai.expect;

const arrayEquility = (arr1, arr2) => {
  if (arr1.length !== arr2.length) return false;
  arr1.sort();
  arr2.sort();
  _.forEach(_.zip(arr1, arr2), _.spread(function (elem1, elem2) {
    if (elem1 !== elem2) return false;
  }));
  return true;
};

describe('Enrichment', function () {
  this.timeout(500000);
  it('it should return a list of pathway identifiers', function () {
    const long_query = "DOT1L AFF4 NAP1L3 BRPF1 TCF20 HLTF SIRT1 TDG SUV39H2 CBX7 DNMT1 DPY30 ING5 MLLT6 CHD1L USP27X BRPF3 ELP4 HCFC1 MARCH5 SCML2 PRDM10 SUPT16H TRIM24 GTF2H1 KDM3A PAF1 PCGF5 BAZ1B NCOA1 UBE2B CCDC101 KDM5B MTA3 PCMT1 GTF3C4 MTA2 RBBP4 RNF20 SETD2 SSRP1 MBD1 POLR2B TP53BP1 UBR7 ARID4B ASH1L BRD4 HAT1 HDAC1 KAT2A MBD3 MSL3 RPA3 BAZ2A JMJD6 PHF7 SIN3B SP100 ZMYND11";
    const expected = ["GO:0008213", "GO:0043414", "GO:0006479", "GO:0018022", "GO:0018023", "GO:0018027", "GO:1902275", "GO:1905268", "GO:0031056", "GO:0031057", "GO:0045814", "GO:0006342", "GO:0006348", "GO:0000183", "GO:0006346", "GO:2001252", "GO:1905269", "GO:0060968", "GO:0031935", "GO:0031937", "GO:0006304", "GO:0006305", "GO:0044728", "GO:0006306", "GO:0061647", "GO:0016571", "GO:0034968", "GO:0051568", "GO:0010452", "GO:0051567", "GO:0031060", "GO:0051570", "GO:0031058", "GO:0031062", "GO:0008214", "GO:0070988", "GO:0006482", "GO:0016577", "GO:0070076", "GO:0006338", "GO:0043044", "GO:0006298", "GO:0050684", "GO:0031440", "GO:0043631", "GO:0006378", "GO:0090342", "GO:0090344", "GO:0007623", "GO:0036260", "GO:0009452", "GO:0006370", "GO:0042769", "GO:0070816", "GO:0043543", "GO:0006473", "GO:0006475", "GO:0018394", "GO:0018393", "GO:0016573", "GO:0043966", "GO:0043967", "GO:0043984", "GO:1901796", "GO:0046825", "GO:0006333", "GO:0006323", "GO:0031497", "GO:0032508", "GO:0034728", "GO:0034723", "GO:0034724", "GO:0065004", "GO:0006334", "GO:0006335", "GO:0006289", "GO:0006283", "GO:0070911", "GO:0033683", "GO:0006296", "GO:0006295", "GO:0000717", "GO:0006294", "GO:0006293", "GO:0006284", "GO:0098732", "GO:0035601", "GO:0006476", "GO:0016575", "GO:0070932", "GO:0006354", "GO:0006368", "GO:0032784", "GO:0034243", "GO:0032786", "GO:0032968", "GO:0006513", "GO:0016574", "GO:0033523", "GO:0010390", "GO:0048545", "GO:0071383", "GO:0009755", "GO:0043401", "GO:0030518", "GO:0030521", "GO:0060765", "GO:0033144", "GO:0060766"];
    return enrichment(long_query).then(function (res) {
      expect(arrayEquility(expected, res)).to.equal(true);
    });
  });
  it('it should return a list of pathway identifiers', function () {
    const short_query = "BRCA1 BRCA2";
    const expected = [ 'GO:0006289', 'GO:0000726', 'GO:0006310', 'GO:0000732', 'GO:0000725', 'GO:0006302', 'GO:0006303', 'GO:0000724', 'GO:0000729', 'GO:0042770', 'GO:0042772', 'GO:0030330', 'GO:0006978', 'GO:2001020', 'GO:2001022', 'GO:0051054', 'GO:0006282', 'GO:0045739', 'GO:0071897', 'GO:0000731', 'GO:0032886', 'GO:0070507', 'GO:0031023', 'GO:0007098', 'GO:0051298', 'GO:0046605', 'GO:0010824', 'GO:0098534', 'GO:1902115', 'GO:1902116', 'GO:0051494', 'GO:0046606', 'GO:0010826', 'GO:0007099', 'GO:0046599', 'GO:0046600', 'GO:0009792', 'GO:0043009', 'GO:0051865', 'GO:0043627', 'GO:0048732', 'GO:0030879', 'GO:0050678', 'GO:0050680', 'GO:0061180', 'GO:0033598', 'GO:0033599', 'GO:0051301', 'GO:0000910', 'GO:0031570', 'GO:0000077', 'GO:0031572', 'GO:1904018', 'GO:0045766', 'GO:0006301', 'GO:0097191', 'GO:0008625', 'GO:2001236', 'GO:1902041', 'GO:2001234', 'GO:2001237', 'GO:1902042', 'GO:0010573', 'GO:0010574', 'GO:0010575', 'GO:0006383', 'GO:0006359', 'GO:1901796', 'GO:1903322', 'GO:0031398', 'GO:0097305', 'GO:0071680', 'GO:0097306', 'GO:0071681', 'GO:0010212', 'GO:0072593', 'GO:2000377', 'GO:2000378', 'GO:0048545', 'GO:0071383', 'GO:0009755', 'GO:0043401', 'GO:0030518', 'GO:0030521', 'GO:0030520', 'GO:0033143', 'GO:0033146', 'GO:0033144', 'GO:0033147', 'GO:0085020', 'GO:0006261', 'GO:0045005', 'GO:0031297', 'GO:0044786', 'GO:0033260', 'GO:1902969', 'GO:0008630', 'GO:0071156', 'GO:0071158', 'GO:0043543', 'GO:0006473', 'GO:1901983', 'GO:0006475', 'GO:0018394', 'GO:2000756', 'GO:0018393', 'GO:0016573', 'GO:0043966', 'GO:0043967', 'GO:0043984', 'GO:1901984', 'GO:2000757', 'GO:1901985', 'GO:2000758', 'GO:0008213', 'GO:0043414', 'GO:0006479', 'GO:0018022', 'GO:1902275', 'GO:2001251', 'GO:1905268', 'GO:2001252', 'GO:1905269', 'GO:0061647', 'GO:0043970', 'GO:0016571', 'GO:0034968', 'GO:0051568', 'GO:0051567', 'GO:0031056', 'GO:0031057', 'GO:0031060', 'GO:0051569', 'GO:0051570', 'GO:0031061', 'GO:0051573', 'GO:0035065', 'GO:0090239', 'GO:2000615', 'GO:0035067', 'GO:0031058', 'GO:0031062', 'GO:0051571', 'GO:0035066', 'GO:0090240', 'GO:0034502', 'GO:0070199', 'GO:0070198', 'GO:0070200', 'GO:0072330', 'GO:0042180', 'GO:0010565', 'GO:0045833', 'GO:0046890', 'GO:0051055', 'GO:0006633', 'GO:0019217', 'GO:0045922', 'GO:0042304', 'GO:0045717', ];
    return enrichment(short_query).then(function (res) {
      expect(arrayEquility(expected, res)).to.equal(true);
    });
  });
});
